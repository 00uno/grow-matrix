<!DOCTYPE html>
<parameter name="html lang=" es">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrowOps Matrix Calendar v4.0 - Command Center</title>
    <style>
      :root {
        --bg-color: #000000;
        --text-color: #00FF00;
        --dim-text: #004400;
        --highlight: #00CC00;
        --warning: #FFFF00;
        --danger: #FF0000;
        --border-color: #003300;
        --font-main: 'Courier New', Courier, monospace;
      }

      * {
        box-sizing: border-box;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        font-family: var(--font-main);
        margin: 0;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        text-shadow: 0 0 2px var(--dim-text);
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--bg-color);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--border-color);
        border: 1px solid var(--text-color);
      }

      header {
        padding: 10px 20px;
        border-bottom: 1px solid var(--text-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(0, 20, 0, 0.9);
        z-index: 10;
      }

      h1 {
        margin: 0;
        font-size: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      /* Status Indicator */
      .status-online {
        color: #00FF00;
        text-shadow: 0 0 5px #00FF00;
        font-weight: bold;
        font-size: 0.8rem;
        margin-left: 20px;
      }

      .status-offline {
        color: #555;
        font-size: 0.8rem;
        margin-left: 20px;
      }

      .config-area {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-left: auto;
      }

      input[type="date"] {
        background: black;
        color: var(--text-color);
        border: 1px solid var(--text-color);
        padding: 5px;
        font-family: var(--font-main);
        cursor: pointer;
      }

      /* Calendar Section */
      .calendar-section {
        padding: 20px;
        overflow-y: auto;
        height: 100%;
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        font-size: 1.2rem;
        font-weight: bold;
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
      }

      .day-name {
        text-align: center;
        padding: 10px;
        color: var(--highlight);
        border-bottom: 1px solid var(--border-color);
      }

      .day-cell {
        border: 2px solid var(--border-color);
        min-height: 100px;
        padding: 5px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        display: flex;
        flex-direction: column;
      }

      .day-cell:hover {
        background-color: rgba(0, 255, 0, 0.1);
        box-shadow: 0 0 10px var(--dim-text);
      }

      .day-cell.today {
        background-color: rgba(0, 50, 0, 0.5);
      }

      .date-number {
        font-weight: bold;
        font-size: 0.9rem;
      }

      .plant-age {
        font-size: 0.7rem;
        color: var(--highlight);
        margin-top: 2px;
      }

      /* Data Summary in Grid */
      .data-summary {
        margin-top: 5px;
        font-size: 9px;
        line-height: 1.3;
        flex-grow: 1;
      }

      .data-summary div {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        margin-bottom: 1px;
      }

      .env {
        color: #aaa;
      }

      .water {
        color: #0ff;
      }

      .lux {
        color: #ff0;
      }

      .notes {
        color: #0f0;
      }

      /* Modal Overlay */
      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        z-index: 999;
        align-items: center;
        justify-content: center;
      }

      .modal-overlay.active {
        display: flex;
      }

      /* Modal Container */
      .data-modal {
        background: black;
        border: 2px solid var(--text-color);
        box-shadow: 0 0 30px var(--text-color);
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        padding: 20px;
        position: relative;
      }

      .modal-header {
        font-size: 1.3rem;
        font-weight: bold;
        margin-bottom: 15px;
        text-transform: uppercase;
        border-bottom: 1px solid var(--border-color);
        padding-bottom: 10px;
      }

      .modal-section {
        margin-bottom: 15px;
      }

      .modal-section label {
        display: block;
        margin-bottom: 5px;
        font-size: 0.85rem;
        color: var(--highlight);
      }

      .input-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
      }

      .input-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .input-wrapper span {
        font-size: 0.75rem;
        color: var(--dim-text);
        margin-bottom: 3px;
      }

      input[type="number"],
      input[type="text"],
      textarea,
      select {
        background: black;
        color: var(--text-color);
        border: 1px solid var(--text-color);
        padding: 8px;
        font-family: var(--font-main);
        width: 100%;
        font-size: 0.9rem;
      }

      input[type="number"]:focus,
      input[type="text"]:focus,
      textarea:focus {
        outline: none;
        box-shadow: 0 0 5px var(--highlight);
      }

      textarea {
        min-height: 80px;
        resize: vertical;
      }

      /* VPD Display */
      .vpd-display {
        padding: 10px;
        border: 1px solid var(--border-color);
        text-align: center;
        font-weight: bold;
        font-size: 1rem;
        margin-top: 5px;
      }

      /* Water Counter */
      .water-counter {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      input[type="checkbox"] {
        accent-color: var(--text-color);
        width: 18px;
        height: 18px;
        cursor: pointer;
      }

      .checkbox-label {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        font-size: 0.9rem;
        margin-bottom: 8px;
      }

      button {
        background: black;
        color: var(--text-color);
        border: 1px solid var(--text-color);
        padding: 10px 15px;
        font-family: var(--font-main);
        text-transform: uppercase;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.9rem;
      }

      button:hover {
        background: var(--text-color);
        color: black;
        box-shadow: 0 0 15px var(--text-color);
      }

      .modal-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .modal-actions button {
        flex: 1;
        padding: 12px;
        font-weight: bold;
      }

      .btn-secondary {
        border-color: var(--dim-text);
        color: var(--dim-text);
      }

      .btn-secondary:hover {
        background: var(--dim-text);
        color: black;
      }

      /* Matrix Rain Canvas */
      #matrix-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        opacity: 0.1;
        pointer-events: none;
      }
    </style>
  </head>

  <body>

    <canvas id="matrix-bg"></canvas>

    <header>
      <h1>GrowOps v4.0 - Command Center</h1>
      <span id="db-status" class="status-offline">[ FIREBASE: INIT... ]</span>
      <div class="config-area">
        <label>GERMINATION DATE:</label>
        <input type="date" id="germination-date">
      </div>
    </header>

    <section class="calendar-section">
      <div class="calendar-header">
        <button id="prev-month">&lt;</button>
        <span id="current-month-display">LOADING...</span>
        <button id="next-month">&gt;</button>
      </div>
      <div class="calendar-grid" id="calendar-grid">
        <!-- Generated by JS -->
      </div>
    </section>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modal-overlay">
      <div class="data-modal">
        <div class="modal-header" id="modal-title">DAY REPORT</div>

        <!-- Environment Section -->
        <div class="modal-section">
          <label>ENVIRONMENT</label>
          <div class="input-row">
            <div class="input-wrapper">
              <span>TEMPERATURE (Â°C)</span>
              <input type="number" id="modal-temp" placeholder="24" step="0.1">
            </div>
            <div class="input-wrapper">
              <span>HUMIDITY (%)</span>
              <input type="number" id="modal-rh" placeholder="60" step="1">
            </div>
          </div>
          <div id="vpd-display" class="vpd-display">VPD: -- kPa</div>
        </div>

        <!-- Lux Section -->
        <div class="modal-section">
          <label>LIGHT INTENSITY (LUX)</label>
          <input type="number" id="modal-lux" list="lux-presets" placeholder="TYPE OR SELECT PRESET">
          <datalist id="lux-presets">
            <option value="0">Off</option>
            <option value="7000">LEC 50% (Low)</option>
            <option value="30000">LEC 75% (Veg)</option>
            <option value="60000">LEC 100% (Bloom)</option>
          </datalist>
        </div>

        <!-- Water Section -->
        <div class="modal-section">
          <label>WATERING (L)</label>
          <div class="water-counter">
            <button id="modal-add-water">+0.5L</button>
            <span id="modal-water-display">0.0 L</span>
            <button id="modal-reset-water" style="font-size: 0.8rem; padding: 5px;">RESET</button>
          </div>
        </div>

        <!-- Nutrients Section -->
        <div class="modal-section">
          <label>NUTRIENTS</label>
          <div class="checkbox-label">
            <input type="checkbox" id="modal-root">
            ROOT STIMULATOR
          </div>
          <div class="checkbox-label">
            <input type="checkbox" id="modal-fert">
            FERTILIZER / NUTRIENTS
          </div>
        </div>

        <!-- Notes Section -->
        <div class="modal-section">
          <label>LOG / COMMENTS</label>
          <textarea id="modal-notes" placeholder="Daily observations, adjustments, anomalies..."></textarea>
        </div>

        <!-- Actions -->
        <div class="modal-actions">
          <button id="copy-yesterday-btn" class="btn-secondary">COPY FROM YESTERDAY</button>
          <button id="save-close-btn">SAVE & CLOSE</button>
        </div>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

      /**
       * GrowOps Matrix Calendar v4.0 - Command Center
       * Features: Modal Interface, VPD Calculation, Hybrid Lux Input, Enhanced Grid Visualization
       */

      // --- Firebase Config ---
      const firebaseConfig = {
        apiKey: "AIzaSyBzjkda5C3__QB8jglOQK79HDfvxVZ8iGQ",
        authDomain: "grow-matrix.firebaseapp.com",
        databaseURL: "https://grow-matrix-default-rtdb.firebaseio.com",
        projectId: "grow-matrix",
        storageBucket: "grow-matrix.firebasestorage.app",
        messagingSenderId: "1004789173992",
        appId: "1:1004789173992:web:0aa39431f84cd4937c435d"
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      // --- State Management ---
      const STATE = {
        germinationDate: null,
        currentViewDate: new Date(),
        selectedDate: null, // String YYYY-MM-DD
        data: {} // Key: YYYY-MM-DD, Value: { water, root, fert, notes, temp, rh, lux }
      };

      // --- DOM Elements ---
      const els = {
        germinationInput: document.getElementById('germination-date'),
        grid: document.getElementById('calendar-grid'),
        monthDisplay: document.getElementById('current-month-display'),
        prevBtn: document.getElementById('prev-month'),
        nextBtn: document.getElementById('next-month'),
        dbStatus: document.getElementById('db-status'),

        // Modal
        modalOverlay: document.getElementById('modal-overlay'),
        modalTitle: document.getElementById('modal-title'),
        modalTemp: document.getElementById('modal-temp'),
        modalRh: document.getElementById('modal-rh'),
        vpdDisplay: document.getElementById('vpd-display'),
        modalLux: document.getElementById('modal-lux'),
        modalWaterDisplay: document.getElementById('modal-water-display'),
        modalAddWaterBtn: document.getElementById('modal-add-water'),
        modalResetWaterBtn: document.getElementById('modal-reset-water'),
        modalRoot: document.getElementById('modal-root'),
        modalFert: document.getElementById('modal-fert'),
        modalNotes: document.getElementById('modal-notes'),
        copyYesterdayBtn: document.getElementById('copy-yesterday-btn'),
        saveCloseBtn: document.getElementById('save-close-btn')
      };

      // --- Initialization ---
      function init() {
        setupFirebaseListener();
        renderCalendar();
        setupEventListeners();
        setupMatrixRain();
      }

      // --- Data Persistence (Firebase) ---
      function setupFirebaseListener() {
        const dbRef = ref(db, 'growData');
        onValue(dbRef, (snapshot) => {
          const data = snapshot.val();
          if (data) {
            STATE.germinationDate = data.germinationDate || null;
            STATE.data = data.data || {};

            // Update UI from external changes
            if (STATE.germinationDate) els.germinationInput.value = STATE.germinationDate;
            renderCalendar();
          }

          // Update Status
          els.dbStatus.innerText = "[ FIREBASE: ONLINE ]";
          els.dbStatus.className = "status-online";
        }, (error) => {
          console.error(error);
          els.dbStatus.innerText = "[ FIREBASE: ERROR ]";
          els.dbStatus.className = "status-offline";
          els.dbStatus.style.color = "red";
        });
      }

      function saveData() {
        const payload = {
          germinationDate: STATE.germinationDate,
          data: STATE.data
        };

        set(ref(db, 'growData'), payload)
          .then(() => {
            console.log("Data saved to Firebase");
          })
          .catch((error) => {
            console.error("Save failed", error);
            alert("ERROR SAVING TO CLOUD");
          });
      }

      // --- VPD Calculation ---
      function calculateVPD(tempC, rh) {
        if (!tempC || !rh || isNaN(tempC) || isNaN(rh)) {
          return { vpd: null, status: 'unknown', color: '#555' };
        }

        // Saturation Vapor Pressure (kPa) using simplified formula
        const svp = 0.61078 * Math.exp((17.27 * tempC) / (tempC + 237.3));
        // Actual Vapor Pressure
        const avp = svp * (rh / 100);
        // VPD
        const vpd = svp - avp;

        // Classify VPD
        let status = 'OPTIMAL';
        let color = '#00FF00';

        if (vpd < 0.4 || vpd > 1.6) {
          status = 'CRITICAL';
          color = '#FF0000';
        } else if (vpd < 0.8 || vpd > 1.2) {
          status = 'WARNING';
          color = '#FFFF00';
        }

        return { vpd: vpd.toFixed(2), status, color };
      }

      // --- Modal Functions ---
      function openModal(dateStr) {
        STATE.selectedDate = dateStr;

        // Calculate age
        let age = -1;
        let ageText = "PRE-GERMINATION";
        if (STATE.germinationDate) {
          age = calculateAge(STATE.germinationDate, dateStr);
          if (age >= 0) {
            ageText = `DAY ${age}`;
          }
        }

        els.modalTitle.innerText = `${ageText} REPORT - ${dateStr}`;

        // Load data
        const dayData = STATE.data[dateStr] || {
          water: 0, root: false, fert: false, notes: '',
          temp: '', rh: '', lux: ''
        };

        // Ensure data exists in STATE
        if (!STATE.data[dateStr]) {
          STATE.data[dateStr] = { water: 0, root: false, fert: false, notes: '', temp: '', rh: '', lux: '' };
        }

        els.modalTemp.value = dayData.temp || '';
        els.modalRh.value = dayData.rh || '';
        els.modalLux.value = dayData.lux || '';
        els.modalWaterDisplay.innerText = `${(dayData.water || 0).toFixed(1)} L`;
        els.modalRoot.checked = dayData.root || false;
        els.modalFert.checked = dayData.fert || false;
        els.modalNotes.value = dayData.notes || '';

        updateVPDDisplay();
        els.modalOverlay.classList.add('active');
      }

      function closeModal() {
        els.modalOverlay.classList.remove('active');
        STATE.selectedDate = null;
      }

      function updateVPDDisplay() {
        const temp = parseFloat(els.modalTemp.value);
        const rh = parseFloat(els.modalRh.value);
        const vpdResult = calculateVPD(temp, rh);

        if (vpdResult.vpd) {
          els.vpdDisplay.innerText = `VPD: ${vpdResult.vpd} kPa [${vpdResult.status}]`;
          els.vpdDisplay.style.color = vpdResult.color;
          els.vpdDisplay.style.borderColor = vpdResult.color;
        } else {
          els.vpdDisplay.innerText = "VPD: -- kPa";
          els.vpdDisplay.style.color = '#555';
          els.vpdDisplay.style.borderColor = 'var(--border-color)';
        }
      }

      function saveAndClose() {
        if (!STATE.selectedDate) return;

        // Update data from modal inputs
        STATE.data[STATE.selectedDate].temp = els.modalTemp.value;
        STATE.data[STATE.selectedDate].rh = els.modalRh.value;
        STATE.data[STATE.selectedDate].lux = els.modalLux.value;
        STATE.data[STATE.selectedDate].root = els.modalRoot.checked;
        STATE.data[STATE.selectedDate].fert = els.modalFert.checked;
        STATE.data[STATE.selectedDate].notes = els.modalNotes.value;
        // Water is already updated in real-time

        saveData();
        renderCalendar();
        closeModal();
      }

      function copyFromYesterday() {
        if (!STATE.selectedDate) return;

        const currentDate = new Date(STATE.selectedDate);
        currentDate.setDate(currentDate.getDate() - 1);
        const yesterdayStr = getFormattedDate(currentDate);
        const yesterdayData = STATE.data[yesterdayStr];

        if (yesterdayData) {
          els.modalTemp.value = yesterdayData.temp || '';
          els.modalRh.value = yesterdayData.rh || '';
          els.modalLux.value = yesterdayData.lux || '';
          STATE.data[STATE.selectedDate].water = yesterdayData.water || 0;
          els.modalWaterDisplay.innerText = `${STATE.data[STATE.selectedDate].water.toFixed(1)} L`;
          els.modalRoot.checked = yesterdayData.root || false;
          els.modalFert.checked = yesterdayData.fert || false;
          // Don't copy notes

          updateVPDDisplay();
        } else {
          alert('NO DATA FROM YESTERDAY');
        }
      }

      // --- Calendar Logic ---
      function renderCalendar() {
        els.grid.innerHTML = '';

        const year = STATE.currentViewDate.getFullYear();
        const month = STATE.currentViewDate.getMonth();

        const monthNames = ["JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE", "JULY", "AUGUST", "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"];
        els.monthDisplay.innerText = `${monthNames[month]} ${year}`;

        const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
        days.forEach(d => {
          const div = document.createElement('div');
          div.className = 'day-name';
          div.innerText = d;
          els.grid.appendChild(div);
        });

        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const daysInMonth = lastDay.getDate();
        const startDayIndex = firstDay.getDay();

        for (let i = 0; i < startDayIndex; i++) {
          const div = document.createElement('div');
          div.className = 'day-cell';
          div.style.opacity = '0.3';
          div.style.cursor = 'default';
          els.grid.appendChild(div);
        }

        const todayStr = getFormattedDate(new Date());

        for (let i = 1; i <= daysInMonth; i++) {
          const dateObj = new Date(year, month, i);
          const dateStr = getFormattedDate(dateObj);
          const dayData = STATE.data[dateStr];

          const cell = document.createElement('div');
          cell.className = 'day-cell';
          if (dateStr === todayStr) cell.classList.add('today');

          const numDiv = document.createElement('div');
          numDiv.className = 'date-number';
          numDiv.innerText = i;
          cell.appendChild(numDiv);

          // Plant Age
          if (STATE.germinationDate) {
            const age = calculateAge(STATE.germinationDate, dateStr);
            if (age >= 0) {
              const ageDiv = document.createElement('div');
              ageDiv.className = 'plant-age';
              ageDiv.innerText = `Day ${age}`;
              cell.appendChild(ageDiv);
            }
          }

          // Data Summary
          if (dayData) {
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'data-summary';

            // Environment
            if (dayData.temp || dayData.rh) {
              const envDiv = document.createElement('div');
              envDiv.className = 'env';
              const tempStr = dayData.temp ? `ðŸŒ¡ï¸ ${dayData.temp}Â°` : '';
              const rhStr = dayData.rh ? `ðŸ’§ ${dayData.rh}%` : '';
              envDiv.innerText = [tempStr, rhStr].filter(s => s).join(' | ');
              summaryDiv.appendChild(envDiv);
            }

            // Water
            if (dayData.water > 0) {
              const waterDiv = document.createElement('div');
              waterDiv.className = 'water';
              waterDiv.innerText = `ðŸš¿ ${dayData.water.toFixed(1)}L`;
              summaryDiv.appendChild(waterDiv);
            }

            // Lux
            if (dayData.lux) {
              const luxDiv = document.createElement('div');
              luxDiv.className = 'lux';
              luxDiv.innerText = `âš¡ ${dayData.lux}`;
              summaryDiv.appendChild(luxDiv);
            }

            // Notes indicator
            if (dayData.notes && dayData.notes.trim()) {
              const notesDiv = document.createElement('div');
              notesDiv.className = 'notes';
              notesDiv.innerText = 'ðŸ“';
              summaryDiv.appendChild(notesDiv);
            }

            cell.appendChild(summaryDiv);

            // VPD Border Color
            if (dayData.temp && dayData.rh) {
              const vpdResult = calculateVPD(parseFloat(dayData.temp), parseFloat(dayData.rh));
              cell.style.borderColor = vpdResult.color;
            }
          }

          cell.onclick = () => openModal(dateStr);
          els.grid.appendChild(cell);
        }
      }

      function calculateAge(germDateStr, targetDateStr) {
        const germ = new Date(germDateStr);
        const target = new Date(targetDateStr);
        germ.setHours(0, 0, 0, 0);
        target.setHours(0, 0, 0, 0);
        const diffTime = target - germ;
        return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      }

      function getFormattedDate(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
      }

      // --- Event Listeners ---
      function setupEventListeners() {
        els.prevBtn.onclick = () => {
          STATE.currentViewDate.setMonth(STATE.currentViewDate.getMonth() - 1);
          renderCalendar();
        };

        els.nextBtn.onclick = () => {
          STATE.currentViewDate.setMonth(STATE.currentViewDate.getMonth() + 1);
          renderCalendar();
        };

        els.germinationInput.onchange = (e) => {
          STATE.germinationDate = e.target.value;
          saveData();
          renderCalendar();
        };

        // Modal: Temperature & RH change
        els.modalTemp.oninput = updateVPDDisplay;
        els.modalRh.oninput = updateVPDDisplay;

        // Modal: Water controls
        els.modalAddWaterBtn.onclick = () => {
          if (!STATE.selectedDate) return;
          STATE.data[STATE.selectedDate].water += 0.5;
          els.modalWaterDisplay.innerText = `${STATE.data[STATE.selectedDate].water.toFixed(1)} L`;
        };

        els.modalResetWaterBtn.onclick = () => {
          if (!STATE.selectedDate) return;
          STATE.data[STATE.selectedDate].water = 0;
          els.modalWaterDisplay.innerText = "0.0 L";
        };

        // Modal: Actions
        els.saveCloseBtn.onclick = saveAndClose;
        els.copyYesterdayBtn.onclick = copyFromYesterday;

        // Modal: Close on overlay click
        els.modalOverlay.onclick = (e) => {
          if (e.target === els.modalOverlay) {
            closeModal();
          }
        };

        // Modal: Close on Escape key
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && els.modalOverlay.classList.contains('active')) {
            closeModal();
          }
        });
      }

      // --- Visuals: Matrix Rain ---
      function setupMatrixRain() {
        const canvas = document.getElementById('matrix-bg');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const chars = '01';
        const fontSize = 14;
        const columns = canvas.width / fontSize;
        const drops = [];

        for (let x = 0; x < columns; x++) drops[x] = 1;

        function draw() {
          ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          ctx.fillStyle = '#0F0';
          ctx.font = fontSize + 'px monospace';

          for (let i = 0; i < drops.length; i++) {
            const text = chars.charAt(Math.floor(Math.random() * chars.length));
            ctx.fillText(text, i * fontSize, drops[i] * fontSize);

            if (drops[i] * fontSize > canvas.height && Math.random() > 0.975)
              drops[i] = 0;

            drops[i]++;
          }
        }
        setInterval(draw, 50);

        window.onresize = () => {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        };
      }

      init();

    </script>
  </body>

  </html>